<div class="statistic-filter">
  <mat-form-field>
    <mat-label>Heat map selection</mat-label>
    <mat-select (selectionChange)="updateData()" [formControl]="statisticSelection">
      <mat-option [value]="'avgCompletionTime'">Avg. completion time</mat-option>
      <mat-option [value]="'avgQueueTime'">Avg. queue time</mat-option>
      <mat-option [value]="'avgTimeToReach'">Avg. time to reach task</mat-option>
      <mat-option [value]="'cost'">Avg. cost of task</mat-option>
    </mat-select>
  </mat-form-field>
</div>
<mat-grid-list *ngIf="loaded && specificationDataContainer !== undefined" cols="5" rowHeight="2:1"
               [gutterSize]="'8px'">
  <mat-grid-tile colspan="5">
    <div class="statistic-container">
      <div class="statistic-title">Heat Map</div>
      <div class="statistic-body ngx-charts-extra-small-text">
        <div class="statistic-graph">
          <ngx-charts-heat-map
            [animations]="false"
            [scheme]="'solar'"
            [legend]="true"
            [showXAxisLabel]="false"
            [showYAxisLabel]="false"
            [xAxis]="true"
            [yAxis]="false"
            [xAxisLabel]="''"
            [yAxisLabel]="''"
            [tooltipText]="heatMapTooltipText"
            [results]="heatMapData"
          >
          </ngx-charts-heat-map>
        </div>
        <div class="statistic-label"></div>
      </div>
    </div>
  </mat-grid-tile>
</mat-grid-list>


<div class="statistic-filter">
  <mat-form-field appearance="legacy">
    <mat-label>Select statistic range</mat-label>
    <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
      <input (dateChange)="updateOnlyStatisticData()" matStartDate formControlName="start" placeholder="Start date">
      <input (dateChange)="updateOnlyStatisticData()" matEndDate formControlName="end" placeholder="End date">
    </mat-date-range-input>
    <mat-hint *ngIf="this.casesInRange !== 0">Cases found: {{ this.casesInRange }}</mat-hint>
    <mat-hint *ngIf="this.casesInRange === 0" style="color: darkred">Cases found: {{ this.casesInRange }}</mat-hint>
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-date-range-picker #picker></mat-date-range-picker>

    <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')">Invalid start date</mat-error>
    <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')">Invalid end date</mat-error>
  </mat-form-field>
  <mat-form-field appearance="legacy" class="mat-form-field-space">
    <mat-label>Statistic fineness</mat-label>
    <mat-select [(value)]="fineness" (valueChange)="updateOnlyStatisticData()">
      <mat-option [value]="'month'">{{ 'month' }}</mat-option>
      <mat-option [value]="'year'">{{ 'year' }}</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field class="mat-form-field-space">
    <mat-label>Selected task</mat-label>
    <input matInput [value]="specificTaskStatistic" required disabled="true">
  </mat-form-field>
</div>

<div [hidden]="specificTaskStatistic !== ''" style="margin-top: .5em;">
  <mat-grid-list cols="5" rowHeight="3:1"
                 [gutterSize]="'8px'">
    <mat-grid-tile colspan="5" rowspan="2">
      <div class="statistic-container">
        <div class="statistic-title">No task selected</div>
        <div class="statistic-body ngx-charts-extra-small-text">
          <div class="statistic-graph">

          </div>
          <div class="statistic-label"></div>
        </div>
      </div>
    </mat-grid-tile>
  </mat-grid-list>
</div>

<div [hidden]="specificTaskStatistic === ''" style="margin-top: .5em;">
  <mat-grid-list cols="5" rowHeight="3:1"
                 [gutterSize]="'8px'">
    <mat-grid-tile rowspan="2">
      <div class="statistic-container">
        <div class="statistic-title">
          <div class="statistic-title-text">How long does the selected task run usually?</div>
          <div class="statistic-title-info">
            <fa-icon [fixedWidth]="true" [icon]="faCircleInfo"
                     matTooltip="This chart visualizes the average time it takes to complete the selected task ({{specificTaskStatistic}}) for each period.
                                 For the calculation of the average completion time of one period all task instances started
                                 in that period were considered. Cancelled tasks excluded."></fa-icon>
          </div>
        </div>
        <div class="statistic-body ngx-charts-small-text">
          <div class="statistic-graph">
            <app-chart-capsule class="chart-capsule" [type]="'bar'"
                               [datasets]="avgCompletionTimeOverPeriodsData.datasets"
                               [labels]="avgCompletionTimeOverPeriodsData.labels"
                               [options]="avgCompletionTimeOverPeriodsOptions"></app-chart-capsule>
          </div>
        </div>
      </div>
    </mat-grid-tile>
    <mat-grid-tile rowspan="2">
      <div class="statistic-container">
        <div class="statistic-title">
          <div class="statistic-title-text">How do our resources perform on average on the selected task?</div>
          <div class="statistic-title-info">
            <fa-icon [fixedWidth]="true" [icon]="faCircleInfo"
                     matTooltip="This chart visualizes the average time it takes to complete the selected task ({{specificTaskStatistic}} for our resources."></fa-icon>
          </div>
        </div>
        <div class="statistic-body ngx-charts-small-text">
          <div class="statistic-graph">
            <app-chart-capsule class="chart-capsule" [type]="'bar'"
                               [datasets]="participantAvgPerformanceData.datasets"
                               [labels]="participantAvgPerformanceData.labels"
                               [options]="participantAvgPerformanceOptions"></app-chart-capsule>
          </div>
        </div>
      </div>
    </mat-grid-tile>
    <mat-grid-tile rowspan="2">
      <div class="statistic-container">
        <div class="statistic-title">
          <div class="statistic-title-text">What resources usually take on this task?</div>
          <div class="statistic-title-info">
            <fa-icon [fixedWidth]="true" [icon]="faCircleInfo"
                     matTooltip="This chart visualizes the number of work items corresponding to the selected task ({{specificTaskStatistic}})
                      that each resource has processed in total."></fa-icon>
          </div>
        </div>
        <div class="statistic-body ngx-charts-small-text">
          <div class="statistic-graph">
            <app-chart-capsule class="chart-capsule" [type]="'bar'"
                               [datasets]="participantsProcessedInstancesData.datasets"
                               [labels]="participantsProcessedInstancesData.labels"
                               [options]="participantsProcessedInstancesOptions"></app-chart-capsule>
          </div>
        </div>
      </div>
    </mat-grid-tile>
  </mat-grid-list>
</div>
